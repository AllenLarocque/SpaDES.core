<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Restart R programmatically — restartR • SpaDES.core</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Restart R programmatically — restartR" />
<meta property="og:description" content="This will attempt to restart the R session, reloading all packages, and
saving and reloading the simList.
Currently, this is not intended for general use: it has many specialized
pieces for using inside a spades call.
The main purpose for doing this is to clear memory leaks (possibly deep
in R https://github.com/r-lib/fastmap) that are not fully diagnosed.
This is still very experimental.
This should only be used if there are RAM limitations being hit with long running simulations.
It has been tested to work Linux within Rstudio and at a terminal R session.
The way to initiate restarting of R is simply setting the spades.restartRInterval or
setting the equivalent parameter in the restartR core module via:
simInit(..., params = list(.restartR = list(.restartRInterval = 1)), ...)
greater than 0, which is the default,
e.g., options(&quot;spades.restartRInterval&quot; = 100).
This is only intended to restart a simulation in exactly the same place as it was
(i.e., cannot change machines), and because of the restart, the assignment of the spades
call will be either to sim or the user must make such an assignment manually,
e.g., sim &amp;lt;- SpaDES.core:::.pkgEnv$.sim.
This is stated in a message." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-58633549-6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-58633549-6');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SpaDES.core</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/i-introduction.html">01 Introduction to `SpaDES`</a>
    </li>
    <li>
      <a href="../articles/ii-modules.html">02 Building `SpaDES` modules</a>
    </li>
    <li>
      <a href="../articles/iii-cache.html">03 Caching `SpaDES` simulations</a>
    </li>
    <li>
      <a href="../articles/iv-advanced.html">04 Advanced `SpaDES` use</a>
    </li>
    <li>
      <a href="../articles/v-automated-testing.html">05 Automated module testing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/PredictiveEcology/SpaDES.core/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Restart R programmatically</h1>
    <small class="dont-index">Source: <a href='https://github.com/PredictiveEcology/SpaDES.core/blob/master/R/restart.R'><code>R/restart.R</code></a></small>
    <div class="hidden name"><code>restartR.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This will attempt to restart the R session, reloading all packages, and
saving and reloading the <code>simList</code>.
Currently, this is not intended for general use: it has many specialized
pieces for using inside a <code>spades</code> call.
The main purpose for doing this is to clear memory leaks (possibly deep
in R <a href='https://github.com/r-lib/fastmap'>https://github.com/r-lib/fastmap</a>) that are not fully diagnosed.
<em>This is still very experimental</em>.
This should only be used if there are RAM limitations being hit with long running simulations.
It has been tested to work Linux within Rstudio and at a terminal R session.
The way to initiate restarting of R is simply setting the <code>spades.restartRInterval</code> or
setting the equivalent parameter in the <code>restartR</code> core module via:
<code><a href='simInit.html'>simInit(..., params = list(.restartR = list(.restartRInterval = 1)), ...)</a></code>
greater than 0, which is the default,
e.g., <code><a href='https://rdrr.io/r/base/options.html'>options("spades.restartRInterval" = 100)</a></code>.
This is only intended to restart a simulation in exactly the same place as it was
(i.e., cannot change machines), and because of the restart, the assignment of the <code>spades</code>
call will be either to <code>sim</code> or the user must make such an assignment manually,
e.g., <code>sim &lt;- SpaDES.core:::.pkgEnv$.sim</code>.
This is stated in a message.</p>
    </div>

    <pre class="usage"><span class='fu'>restartR</span><span class='op'>(</span>
  <span class='va'>sim</span>,
  reloadPkgs <span class='op'>=</span> <span class='cn'>TRUE</span>,
  .First <span class='op'>=</span> <span class='cn'>NULL</span>,
  .RDataFile <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"spades.restartR.RDataFilename"</span><span class='op'>)</span>,
  restartDir <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"spades.restartR.restartDir"</span>, <span class='cn'>NULL</span><span class='op'>)</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>sim</th>
      <td><p>Required. A <code>simList</code> to be retained through the restart</p></td>
    </tr>
    <tr>
      <th>reloadPkgs</th>
      <td><p>Logical. If <code>TRUE</code>, it will attempt to reload all the packages
as they were in previous session, in the same order. If <code>FALSE</code>, it will
load no packages beyond normal R startup. Default <code>TRUE</code></p></td>
    </tr>
    <tr>
      <th>.First</th>
      <td><p>A function to save to <code class="file">~/.qs</code> which will
be loaded at restart from <code class="file">~/.qs</code> and run. Default is <code>NULL</code>,
meaning it will use the non-exported <code>SpaDES.core:::First</code>. If a
user wants to make a custom <code>First</code> file, it should built off that one.</p></td>
    </tr>
    <tr>
      <th>.RDataFile</th>
      <td><p>A filename for saving the <code>simList</code>.
Defaults to <code><a href='https://rdrr.io/r/base/options.html'>getOption("spades.restartR.filename")</a></code>, and the directory will
be in <code>restartDir</code>. The simulation time will be mid-pended to this
name, as in: <code>basename(file), "_time",</code>
<code>paddedFloatToChar(time(sim), padL = nchar(as.character(end(sim))))))</code></p></td>
    </tr>
    <tr>
      <th>restartDir</th>
      <td><p>A character string indicating root directory to
save <code>simList</code> and other ancillary files during restart.
Defaults to <code><a href='https://rdrr.io/r/base/options.html'>getOption("spades.restartR.restartDir", NULL)</a></code>.
If <code>NULL</code>, then it will try, in order, <code><a href='paths.html'>outputPath(sim)</a></code>,
<code><a href='paths.html'>modulePath(sim)</a></code>, <code><a href='paths.html'>inputPath(sim)</a></code>, <code><a href='paths.html'>cachePath(sim)</a></code>,
taking the first one that is not inside the <code><a href='https://rdrr.io/r/base/tempfile.html'>tempdir()</a></code>, which will
disappear during restart of R.
The actual directory for a given <code>spades</code> call that is restarting will be:
<code><a href='https://rdrr.io/r/base/file.path.html'>file.path(restartDir, "restartR", paste0(sim$._startClockTime, "_", .rndString))</a></code>.
The random string is to prevent parallel processes that started at the same clock
time from colliding.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The process responds to several options. Though under most cases,
the default behaviour should suffice. These are of 3 types: <code>restartRInterval</code>
the arguments to <code>restartR</code> and the arguments to <code>saveSimList</code>, these latter two
using a dot to separate the function name and its argument. The defaults for
two key options are: <code>options("spades.restartR.restartDir" = NULL</code>, meaning
use <code><a href='https://rdrr.io/r/base/file.path.html'>file.path(restartDir, "restartR", paste0(sim$._startClockTime, "_", .rndString))</a></code>
and <code><a href='https://rdrr.io/r/base/options.html'>options("spades.saveSimList.fileBackend" = 0)</a></code>, which means don't do anything
with raster-backed files.
See specific functions for defaults and argument meanings.
The only difference from the default function values is with <code>saveSimList</code> argument
<code>fileBackend = FALSE</code> during <code>restartR</code> by default, because it is assumed that
the file backends will still be intact after a restart, so no need to move them all to memory.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Because of the restarting, the object name of the original assignment of the
<code>spades</code> call can not be preserved. The <code>spades</code> call will be
assigned to <code>sim</code> in the <code>.GlobalEnv</code>.</p>
<p>Because this function is focused on restarting during a <code>spades</code> call,
it will remove all objects in the <code>.GlobalEnv</code>, emulating <code><a href='https://rdrr.io/r/base/quit.html'>q("no")</a></code>.
If the user wants to keep those objects, then they should be saved to disk
immediately before the <code>spades</code> call.
This can then be recovered immediately after the return from the <code>spades</code> call.</p>
<p>To keep the saved <code>simList</code>, use <code><a href='https://rdrr.io/r/base/options.html'>options("spades.restartR.clearFiles" = TRUE)</a></code>.
The default is to treat these files as temporary files and so will be removed.</p>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Alex M Chubaty, Eliot J B McIntire.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


