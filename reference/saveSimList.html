<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Save a whole simList object to disk — saveSimList • SpaDES.core</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Save a whole simList object to disk — saveSimList"><meta property="og:description" content="Saving a simList may not work using the standard approaches (e.g.,
save, saveRDS, and qs::qsave). There are 2 primary reasons why this doesn't
work as expected: the activeBindings that are in place within modules (these
allow the mod and Par to exist), and file-backed objects, such as SpatRaster
and Raster*. Because of these, a user should use saveSimList and loadSimList.
These will save the object and recover the object using the filename supplied,
if there are no file-backed objects. If there are file-backed objects, then it
will save an archive (default is .tar.gz using the archive package for non-Windows
and zip() if using Windows, as there is currently an unidentified bug in archive*
on Windows). The user does not need to specify the filename any differently,
as the code will search based on the filename without the file extension.
zipSimList will save the simList and file-backed Raster* objects, plus,
optionally, files identified in outputs(sim) and inputs(sim).
This uses Copy under the hood, to not affect the original simList.
VERY experimental."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-58633549-6"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-58633549-6');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SpaDES.core</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/i-introduction.html">01 Introduction to `SpaDES`</a>
    </li>
    <li>
      <a href="../articles/ii-modules.html">02 Building `SpaDES` modules</a>
    </li>
    <li>
      <a href="../articles/iii-cache.html">03 Caching `SpaDES` simulations</a>
    </li>
    <li>
      <a href="../articles/iv-advanced.html">04 Advanced `SpaDES` use</a>
    </li>
    <li>
      <a href="../articles/v-automated-testing.html">05 Automated module testing</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/PredictiveEcology/SpaDES.core/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Save a whole <code>simList</code> object to disk</h1>
    <small class="dont-index">Source: <a href="https://github.com/PredictiveEcology/SpaDES.core/blob/HEAD/R/saveLoadSimList.R" class="external-link"><code>R/saveLoadSimList.R</code></a></small>
    <div class="hidden name"><code>saveSimList.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Saving a <code>simList</code> may not work using the standard approaches (e.g.,
<code>save</code>, <code>saveRDS</code>, and <code><a href="https://rdrr.io/pkg/qs/man/qsave.html" class="external-link">qs::qsave</a></code>). There are 2 primary reasons why this doesn't
work as expected: the <code>activeBindings</code> that are in place within modules (these
allow the <code>mod</code> and <code>Par</code> to exist), and file-backed objects, such as <code>SpatRaster</code>
and <code>Raster*</code>. Because of these, a user should use <code>saveSimList</code> and <code>loadSimList</code>.
These will save the object and recover the object using the <code>filename</code> supplied,
if there are no file-backed objects. If there are file-backed objects, then it
will save an archive (default is <code>.tar.gz</code> using the <code>archive</code> package for non-Windows
and <code><a href="https://rdrr.io/r/utils/zip.html" class="external-link">zip()</a></code> if using Windows, as there is currently an unidentified bug in <code>archive*</code>
on Windows). The user does not need to specify the filename any differently,
as the code will search based on the filename without the file extension.</p>
<p><code>zipSimList</code> will save the <code>simList</code> and file-backed <code>Raster*</code> objects, plus,
optionally, files identified in <code>outputs(sim)</code> and <code>inputs(sim)</code>.
This uses <code>Copy</code> under the hood, to not affect the original <code>simList</code>.
<strong>VERY experimental</strong>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">saveSimList</span><span class="op">(</span></span>
<span>  <span class="va">sim</span>,</span>
<span>  <span class="va">filename</span>,</span>
<span>  projectPath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  outputs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  inputs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cache <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">envir</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">zipSimList</span><span class="op">(</span><span class="va">sim</span>, <span class="va">zipfile</span>, <span class="va">...</span>, outputs <span class="op">=</span> <span class="cn">TRUE</span>, inputs <span class="op">=</span> <span class="cn">TRUE</span>, cache <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>sim</dt>
<dd><p>Either a <code>simList</code> or a character string of the name
of a <code>simList</code> that can be found in <code>envir</code>.
Using a character string will assign that object name to the saved
<code>simList</code>, so when it is recovered it will be given that name.</p></dd>


<dt>filename</dt>
<dd><p>Character string with the path for saving <code>simList</code> to or
reading the <code>simList</code> from. Currently, only <code>.rds</code> and <code>.qs</code> file types are supported.</p></dd>


<dt>projectPath</dt>
<dd><p>Should be the "top level" or project path for the <code>simList</code>.
Defaults to <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code>. All other paths will be made relative with respect to
this if nested within this.</p></dd>


<dt>outputs</dt>
<dd><p>Logical. If <code>TRUE</code>, all files identified in
<code>outputs(sim)</code> will be included in the zip.</p></dd>


<dt>inputs</dt>
<dd><p>Logical. If <code>TRUE</code>, all files identified in
<code>inputs(sim)</code> will be included in the zip.</p></dd>


<dt>cache</dt>
<dd><p>Logical. Not yet implemented. If <code>TRUE</code>, all files in <code>cachePath(sim)</code> will be included in the
zip archive. Defaults to <code>FALSE</code> as this could be large, and may include many
out of date elements. See Details.</p></dd>


<dt>envir</dt>
<dd><p>If <code>sim</code> is a character string, then this must be provided.
It is the environment where the object named <code>sim</code> can be found.</p></dd>


<dt>...</dt>
<dd><p>passed to <code>saveSimList()</code>, including non-optional ones such as <code>filename</code>.
Also see <code>fileBackend</code> and <code>filebackedDir</code> arguments in that function.</p></dd>


<dt>zipfile</dt>
<dd><p>A character string indicating the filename for the zip file. Passed to <code>zip</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>For <code>saveSimList()</code>, a saved <code>.qs</code> file in <code>filename</code> location or
a <code>.tar.gz</code> (non-Windows) or <code>.zip</code> (Windows).</p>


<p>invoked for side effect of zip archive creation</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>There is a family of 2 functions that are mutually useful for saving and
loading <code>simList</code> objects and their associated files (e.g., file-backed
<code>Raster*</code>, <code>inputs</code>, <code>outputs</code>, <code>cache</code>) <code>saveSimList()</code>, <code><a href="loadSimList.html">loadSimList()</a></code>.</p>
<div class="section">
<h3 id="save-move-load">Save - Move - Load<a class="anchor" aria-label="anchor" href="#save-move-load"></a></h3>


<p>There are 3 different workflows for "save - move files - load" that work in our tests:</p><ol><li><p><code>fileBackend = 0</code>: No renaming of file-backed rasters. This is unlikely to
work for most use-cases as the original file paths are left intact. Recovery
of this saved <code>simList</code> will only work if the file-backed objects' files are
present and in the exact same paths.</p>
<p>This approach is attempting to emulate a "relative filenames" approach,
i.e., attempt to treat the file-backed raster file names as if they were
relative (which they are not -- raster package forces absolute file
paths). To do this, all the renaming occurs within <code>loadSimList</code>.
These function will use the <code>paths</code> argument to rewrite
the paths of the files that are identified with <code>Filenames(sim)</code> so that
they are in the equivalent (relative) position as they were. This will
only work if all files were in one of the <code>paths</code> of the original
<code>simList</code>, so that they can be matched up with the new <code>paths</code> passed in
<code>loadSimList</code>. This is not guaranteed to work correctly, though it works
in a wide array of testing.</p></li>
<li><p><code>fileBackend = 1</code>: On-the-fly renaming of file-backed rasters;</p><ol><li><p>Save the <code>sim</code> object with a filename, e.g.,  <code>file</code>,</p></li>
<li><p>make a copy of all file-backed rasters to <code>fileBackedDir</code>,</p></li>
<li><p>update all the pointers to those files so that they are correct in the raster metadata</p></li>
</ol><p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveSimList</span>(sim, <span class="at">file =</span> <span class="st">"sim.qs"</span>, <span class="at">fileBackend =</span> <span class="dv">1</span>, <span class="at">fileBackedDir =</span> <span class="st">"here"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>simNew <span class="ot">&lt;-</span> <span class="fu">loadSimList</span>(<span class="at">file =</span> <span class="st">"sim.qs"</span>)</span></code></pre><p></p></div></li>
<li><p><code>fileBackend = 2</code>: On-the-fly bringing to memory of all rasters</p>
<p>All rasters are brought to memory, and then saved into <code>sim.qs</code></p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveSimList</span>(sim, <span class="at">file =</span> <span class="st">"sim.qs"</span>, <span class="at">fileBackend =</span> <span class="dv">2</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>simNew <span class="ot">&lt;-</span> <span class="fu">loadSimList</span>(<span class="at">file =</span> <span class="st">"sim.qs"</span>)</span></code></pre><p></p></div></li>
</ol><p>If <code>cache</code> is used, it is likely that it should be trimmed before
zipping, to include only cache elements that are relevant.</p>
</div>

    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="loadSimList.html">loadSimList()</a></code></p></div>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Alex M Chubaty, Eliot J B McIntire.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

